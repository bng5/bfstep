#!/usr/bin/env node

var bfstep = require('../index.js');
var fs = require('fs');

const estados = [
  'Detenido',
  'Corriendo',
  'Pausado',
  'Esperando entrada'
];
console.log(estados);

function printInfo(obj) {
  console.log('-----------------------------------------------------');
  console.log('arraySize:      ', obj.arraySize);
  console.log('dataPointer:    ', obj.dataPointer);
  // console.log('delay:              ', obj.delay);
  console.log('programPointer: ', obj.programPointer);
  console.log('state:          ', estados[obj.state]);
  // console.log('source:             ', obj.source);
  // console.log('tape:               ', obj.tape);
  // console.log('input:              ', obj.input);
}

var bf = bfstep.create(0, 100);
console.log(bfstep);
console.log(bf);
bf.on('end', function(a,b,c) {
  printInfo(this);
  console.log('end', a,b,c);
});
bf.on('step', function(output) {
  printInfo(this);
  var charPos = (this.programPointer - 1);
  console.log(this.tape.slice(0, 10).join(' | '));
  console.log([this.source.substring(0, charPos), '\x1b[7m', this.source.substr(charPos, 1), '\x1b[0m', this.source.substring(charPos+1)].join(''));
  console.log('step', output);
});
bf.on('statechange', function(a,b,c) {
  printInfo(this);
  console.log('statechange', a,b,c);
});

bf.source = fs.readFileSync(process.argv[2], 'utf8');
printInfo(bf);
bf.run();
